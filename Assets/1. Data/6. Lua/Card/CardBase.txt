CardBase = class(Object, "CardBase")
local this = CardBase

function this:new(arg)
  self.cardView = nil
  self.name = "卡 名"
  self.frame = "CardFrame_1"
  self.image = "placeholder"
  self.desc = "<color=red>规</color><b><color=green>则</color><color=blue>说</color></b>明"
  self.minec = 0
  self.woodc=0
  self.ironc=0
  self.foodc=0
  self.techc=0
  self.faithc=0
  self.cost = 0
  self.rounds = 1
  self.cardType = "testcard"

  self.inHand = false
end

function this:setCardView()
  if self.cost then
    self.cardView.mainCost.gameObject:SetActive(true)
    local color = "white"
    if CostModifiter < 0 then
      color = "green"
    elseif CostModifiter > 0 then
      color = "red"
    end
    local cost = self.cost + CostModifiter
    if cost < 0 then cost = 0 end
    self.cardView.mainCost.text = "<color="..color..">"..cost.."</color>"
  end
end


function this:onPlay()
  if self:canPlay() then
    self:subRc()
    self:laborCost()
    self:applyEffect()
  else
    HandView:AddToHand(self.cardView)
  end
end

function this:canPlay()
  if self:enoughRc() and self:enoughLabor() then return true
  else return false end
end
    
function this:addToHand()
end
    
function this:rmvFrHand()
end

function this:getCardFullName()
  return self.className
end

function this:enoughLabor()
  if GameManager.gameData.idleWorker>=self.cost + CostModifiter then
    return true
  else
    return false
  end
end


function this:laborCost()
  local cost = self.cost + CostModifiter
  if cost <0 then cost = 0 end
  GameManager.gameData.idleWorker = GameManager.gameData.idleWorker - cost
  if cost ==1 then Buff("AddBackLabor1",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,'buff512',"1名工人正在工作")
  elseif cost ==2 then Buff("AddBackLabor2",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","2名工人正在工作")
  elseif cost ==3 then Buff("AddBackLabor3",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","3名工人正在工作")
  elseif cost ==4 then Buff("AddBackLabor4",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","4名工人正在工作")
  elseif cost ==5 then Buff("AddBackLabor5",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","5名工人正在工作")
  elseif cost ==6 then Buff("AddBackLabor6",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","6名工人正在工作")
  elseif cost ==7 then Buff("AddBackLabor7",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","7名工人正在工作")
  elseif cost ==8 then Buff("AddBackLabor8",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","8名工人正在工作")
  elseif cost ==9 then Buff("AddBackLabor9",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","9名工人正在工作")
  elseif cost ==10 then Buff("AddBackLabor10",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","10名工人正在工作")
  elseif cost ==11 then Buff("AddBackLabor11",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","11名工人正在工作")
  elseif cost ==12 then Buff("AddBackLabor12",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","12名工人正在工作")
  elseif cost ==13 then Buff("AddBackLabor13",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","13名工人正在工作")
  elseif cost ==14 then Buff("AddBackLabor14",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","14名工人正在工作")
  elseif cost ==15 then Buff("AddBackLabor15",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","15名工人正在工作")
  elseif cost ==16 then Buff("AddBackLabor16",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","16名工人正在工作")
  elseif cost ==17 then Buff("AddBackLabor17",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","17名工人正在工作")
  elseif cost ==18 then Buff("AddBackLabor18",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","18名工人正在工作")
  elseif cost ==19 then Buff("AddBackLabor19",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","19名工人正在工作")
  elseif cost ==20 then Buff("AddBackLabor20",GameEvent.EnterMainPhase,BuffType.OneShot,self.rounds,"buff512","20名工人正在工作")
  end
end

function this:subRc()
  if self.minec>0 then GameManager.SubResource(ResourceType.Mine,self.minec) end
  if self.woodc>0 then GameManager.SubResource(ResourceType.Wood,self.woodc) end
  if self.ironc>0 then GameManager.SubResource(ResourceType.Iron,self.ironc) end
  if self.foodc>0 then GameManager.SubResource(ResourceType.Food,self.foodc) end
  if self.techc>0 then GameManager.SubResource(ResourceType.Tech,self.techc) end
  if self.faithc>0 then GameManager.SubResource(ResourceType.Faith,self.faithc) end
end


function this:enoughRc()
  if GameManager.GetResource(ResourceType.Wood) >= self.woodc and
  GameManager.GetResource(ResourceType.Mine)>=self.minec and
  GameManager.GetResource(ResourceType.Iron)>=self.ironc and
  GameManager.GetResource(ResourceType.Food)>=self.foodc and
  GameManager.GetResource(ResourceType.Tech)>=self.techc and
  GameManager.GetResource(ResourceType.Faith)>=self.faithc
   then return true
  else return false end
end

function this:applyEffect()
  HandView:AddToHand(self.cardView)
end
